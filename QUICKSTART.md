# ğŸ“‹ í†µí•© ì™„ë£Œ - ìµœì¢… ìš”ì•½

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1ï¸âƒ£ í•µì‹¬ íŒŒì¼ ìˆ˜ì •: `sca_run/team_infer.py`

**ìƒíƒœ:** âœ… ì™„ì „íˆ ìƒˆë¡œ ì‘ì„±ë¨

**ì£¼ìš” ê¸°ëŠ¥:**
```python
def infer_team_wav(cfg, audio_in):
    """
    Log-Mel Spectrogram â†’ ìŒì„± ìƒì„±
    
    ì…ë ¥: AudioInput(features=[1, 128, T])
    ì¶œë ¥: TeamAudioReturn(wav float32, sr=24000)
    
    ë‚´ë¶€ ì²˜ë¦¬:
    1. Qwen3DuplexLogic ì´ˆê¸°í™”
    2. Thinker: ì˜¤ë””ì˜¤ ì´í•´ â†’ í…ìŠ¤íŠ¸ í† í°
    3. Talker: í…ìŠ¤íŠ¸ â†’ ì˜¤ë””ì˜¤ ì½”ë“œ
    4. Code2Wav: ì½”ë“œ â†’ ìŒì„± [T]
    """
```

**ì¶”ê°€ í•¨ìˆ˜:**
- `_load_qwen_model()`: íŒŒì¸íŠœë‹ ëª¨ë¸ ë¡œë“œ
- `_init_duplex_logic()`: Qwen3DuplexLogic ì´ˆê¸°í™”  
- `reset_conversation()`: ëŒ€í™” ìƒíƒœ ì´ˆê¸°í™”

---

### 2ï¸âƒ£ ìƒˆë¡œ ìƒì„±ëœ ë„ìš°ë¯¸ íŒŒì¼ë“¤

#### `setup_integration.py` âœ¨
í†µí•© ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
```bash
python setup_integration.py
```
- âœ… íŒ€ì› ì½”ë“œ íŒŒì¼ ì¡´ì¬ í™•ì¸
- âœ… í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸
- âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê°€ì´ë“œ

#### `test_integration.py` âœ¨
ëª¨ë“  ë¶€ë¶„ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
```bash
python test_integration.py
```
- âœ… íŒ€ì› ì½”ë“œ ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸
- âœ… Log-Mel ìƒì„± í…ŒìŠ¤íŠ¸
- âœ… server.py ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸
- âœ… ëª¨ë“  ëª¨ë“ˆ ì •ìƒ ì‘ë™ í™•ì¸

#### `run_server.py` âœ¨
ì„œë²„ë¥¼ ë¹ ë¥´ê²Œ ì‹œì‘í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
```bash
python run_server.py
```
- âœ… í•„ìˆ˜ íŒŒì¼ í™•ì¸
- âœ… í™˜ê²½ ë³€ìˆ˜ í™•ì¸
- âœ… ì„œë²„ ìë™ ì‹œì‘

#### `INTEGRATION_GUIDE.md` âœ¨
ìƒì„¸í•œ í†µí•© ê°€ì´ë“œ ë¬¸ì„œ
- âœ… ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ëª…
- âœ… ì„¤ì • ë°©ë²•
- âœ… ë°ì´í„° íë¦„ë„
- âœ… ë¬¸ì œ í•´ê²°

#### `INTEGRATION_COMPLETE.md` âœ¨
í†µí•© ì™„ë£Œ ìµœì¢… ìš”ì•½
- âœ… ë³€ê²½ ì‚¬í•­ ì •ë¦¬
- âœ… ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ
- âœ… íŒŒì¼ êµ¬ì¡° ì„¤ëª…

---

## ğŸš€ ì‹¤í–‰ ë°©ë²• (3ê°€ì§€)

### ë°©ë²• 1: í†µí•© í™•ì¸ í›„ ì‹œì‘ (ê¶Œì¥)
```powershell
# Step 1: í†µí•© ìƒíƒœ í™•ì¸
python setup_integration.py

# Step 2: ì „ì²´ í…ŒìŠ¤íŠ¸
python test_integration.py

# Step 3: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
$env:SCA_QWEN_MODEL_ID = "your_model_path"

# Step 4: ì„œë²„ ì‹œì‘
python run_server.py
```

### ë°©ë²• 2: ì§ì ‘ ì„œë²„ ì‹œì‘
```powershell
$env:SCA_QWEN_MODEL_ID = "your_model_path"
python -m sca_run.server --config config/default.toml
```

### ë°©ë²• 3: ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¹ ë¥´ê²Œ ì‹œì‘
```powershell
python run_server.py
```

---

## ğŸ¯ ë°ì´í„° íë¦„ (ìµœì¢…)

```
ì‚¬ìš©ì ìŒì„± (PCM16, 16kHz)
        â†“
    WebSocket
        â†“
    audio_chunker.py (320ms ë‹¨ìœ„)
        â†“
    feature_extractor.py (Log-Mel [1,128,T])
        â†“
    qwen_client.py (AudioInput ë³€í™˜)
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  team_infer.py âœ¨ (ìƒˆë¡œ ì‘ì„±)           â”‚
    â”‚                                         â”‚
    â”‚  1. _load_qwen_model()                 â”‚
    â”‚     â†’ íŒŒì¸íŠœë‹ Qwen3-Omni ë¡œë“œ         â”‚
    â”‚                                         â”‚
    â”‚  2. _init_duplex_logic()                â”‚
    â”‚     â†’ Qwen3DuplexLogic ì´ˆê¸°í™”          â”‚
    â”‚                                         â”‚
    â”‚  3. infer_team_wav() (ë©”ì¸)             â”‚
    â”‚     a) thinker_step()                  â”‚
    â”‚        Log-Mel [1,128,T] â†’ hidden      â”‚
    â”‚     b) talker_step()                   â”‚
    â”‚        hidden â†’ audio codes             â”‚
    â”‚     c) code2wav_step()                 â”‚
    â”‚        codes â†’ wav [T] float32          â”‚
    â”‚                                         â”‚
    â”‚  â†’ TeamAudioReturn(wav, sr=24000)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    qwen_client.py (PCM16LE ë³€í™˜)
        â†“
    server.py (WebSocket ì „ì†¡)
        â†“
    ë¸Œë¼ìš°ì € (ìŠ¤í”¼ì»¤ ì¬ìƒ) ğŸ”Š
```

---

## ğŸ“Š í†µí•© êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€ íŒ€ì› ì½”ë“œ (src/) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚
â”‚  â€¢ inference.py                       â”‚
â”‚    - Qwen3DuplexLogic í´ë˜ìŠ¤          â”‚
â”‚    - thinker_step()                  â”‚
â”‚    - talker_step()                   â”‚
â”‚    - code2wav()                      â”‚
â”‚                                       â”‚
â”‚  â€¢ interface.py                       â”‚
â”‚    - FullDuplexConfig                â”‚
â”‚    - ConversationState               â”‚
â”‚    - EngineConfig                    â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ (ì„í¬íŠ¸)
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  team_infer.py (ìƒˆë¡œ ì‘ì„±)            â”‚
    â”‚                                       â”‚
    â”‚  â€¢ _load_qwen_model()                â”‚
    â”‚  â€¢ _init_duplex_logic()              â”‚
    â”‚  â€¢ infer_team_wav() â† ë©”ì¸ í•¨ìˆ˜      â”‚
    â”‚  â€¢ reset_conversation()              â”‚
    â”‚                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ (í˜¸ì¶œ)
                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  server.pyì˜ /ws/pcm16                â”‚
    â”‚  qwen_client.pyì˜ extract/convert     â”‚
    â”‚  feature_extractor.pyì˜ log_mel       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ í•µì‹¬ ê°œë…

### 1. Log-Mel Spectrogram
- **ì…ë ¥:** PCM16 ìŒì„± (ì‹œê°„ ì˜ì—­)
- **ì²˜ë¦¬:** STFT â†’ ì£¼íŒŒìˆ˜ ë¶„ì„ â†’ Mel ë³€í™˜ â†’ ë¡œê·¸ ìŠ¤ì¼€ì¼
- **ì¶œë ¥:** [1, 128, T] (128ê°œ ìŒì—­ëŒ€, Tê°œ ì‹œê°„ í”„ë ˆì„)

### 2. Qwen3DuplexLogicì˜ 3ë‹¨ê³„
1. **Thinker:** ì˜¤ë””ì˜¤ë¥¼ ì´í•´í•˜ëŠ” ë¶€ë¶„
   - ì…ë ¥: Log-Mel features [1, 128, T]
   - ì¶œë ¥: í…ìŠ¤íŠ¸ í† í° + hidden states

2. **Talker:** ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ë¶€ë¶„
   - ì…ë ¥: Thinkerì˜ hidden states
   - ì¶œë ¥: ì˜¤ë””ì˜¤ ì½”ë“œ (ì •ìˆ˜ í† í°)

3. **Code2Wav:** ì½”ë“œë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜
   - ì…ë ¥: ì˜¤ë””ì˜¤ ì½”ë“œ
   - ì¶œë ¥: WAV ìŒì„± (float32)

### 3. ìƒ˜í”Œë§ ë ˆì´íŠ¸ ê´€ë¦¬
```
ì…ë ¥ ìŒì„±:   16kHz (ì‚¬ìš©ì ë§ˆì´í¬)
Log-Mel:    16kHz ê¸°ì¤€ ë¶„ì„
ì¶œë ¥ ìŒì„±:   24kHz (Qwen3-Omni ê¸°ë³¸)
```

---

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (í•„ìˆ˜!)

### PowerShell
```powershell
$env:SCA_QWEN_MODEL_ID = "path/to/your/finetuned/model"
$env:SCA_QWEN_DEVICE_MAP = "cuda:0"        # ë˜ëŠ” "auto"
$env:SCA_QWEN_TORCH_DTYPE = "float16"      # ë˜ëŠ” "auto"
```

### Linux / Mac
```bash
export SCA_QWEN_MODEL_ID="path/to/your/finetuned/model"
export SCA_QWEN_DEVICE_MAP="auto"
export SCA_QWEN_TORCH_DTYPE="float16"
```

---

## ğŸ“ˆ ì„±ëŠ¥ ì˜ˆìƒ

### ì²« ë²ˆì§¸ í˜¸ì¶œ (ì‹œê°„ ì†Œìš”)
```
ëª¨ë¸ ë¡œë“œ:        5~30ì´ˆ (HuggingFaceì—ì„œ ë‹¤ìš´ë¡œë“œ)
Duplex Logic ì´ˆê¸°í™”: 1~2ì´ˆ
ì²« ë²ˆì§¸ ì¶”ë¡ :    2~3ì´ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ ì‹œê°„:         8~35ì´ˆ
```

### ì´í›„ í˜¸ì¶œ (ë§¤ìš° ë¹ ë¦„)
```
ì¶”ë¡ ë§Œ:          1~2ì´ˆ (ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°€ëŠ¥!)
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°˜ë“œì‹œ í™•ì¸
- [ ] `src/inference.py` ìˆëŠ”ê°€?
- [ ] `src/interface.py` ìˆëŠ”ê°€?
- [ ] `SCA_QWEN_MODEL_ID` í™˜ê²½ ë³€ìˆ˜ ì„¤ì •í–ˆëŠ”ê°€?
- [ ] `sca_run/team_infer.py`ê°€ ìƒˆë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?

### 2. ë¬¸ì œ í•´ê²°
```
"Module src.inference not found"
â†’ src í´ë”ê°€ sca_runê³¼ ê°™ì€ ë ˆë²¨ì— ìˆëŠ”ì§€ í™•ì¸

"CUDA out of memory"  
â†’ float16 ì‚¬ìš©: $env:SCA_QWEN_TORCH_DTYPE = "float16"

"First call is slow"
â†’ ì •ìƒ! ëª¨ë¸ ë¡œë“œ ë•Œë¬¸. ì´í›„ëŠ” ë¹ ë¦„.
```

---

## ğŸ“ ìµœì¢… íŒŒì¼ êµ¬ì¡°

```
í”„ë¡œì íŠ¸/
â”œâ”€â”€ sca_run/
â”‚   â”œâ”€â”€ server.py âœ…
â”‚   â”œâ”€â”€ team_infer.py âœ¨ (ì™„ì „íˆ ìƒˆë¡œ ì‘ì„±)
â”‚   â”œâ”€â”€ feature_extractor.py âœ…
â”‚   â”œâ”€â”€ qwen_client.py âœ…
â”‚   â”œâ”€â”€ audio_chunker.py âœ…
â”‚   â”œâ”€â”€ config.py âœ…
â”‚   â”œâ”€â”€ io_types.py âœ…
â”‚   â”œâ”€â”€ __main__.py âœ…
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ index.html âœ…
â”‚
â”œâ”€â”€ src/ (íŒ€ì› ì½”ë“œ)
â”‚   â”œâ”€â”€ inference.py âœ…
â”‚   â””â”€â”€ interface.py âœ…
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.toml âœ…
â”‚
â”œâ”€â”€ ğŸ“„ setup_integration.py âœ¨ (ìƒˆ íŒŒì¼)
â”œâ”€â”€ ğŸ“„ test_integration.py âœ¨ (ìƒˆ íŒŒì¼)
â”œâ”€â”€ ğŸ“„ run_server.py âœ¨ (ìƒˆ íŒŒì¼)
â”œâ”€â”€ ğŸ“„ INTEGRATION_GUIDE.md âœ¨ (ìƒˆ íŒŒì¼)
â”œâ”€â”€ ğŸ“„ INTEGRATION_COMPLETE.md âœ¨ (ìƒˆ íŒŒì¼)
â””â”€â”€ ğŸ“„ README.md âœ…
```

---

## ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!

**Qwen3-Omni FullDuplex í†µí•©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!**

### ë‹¤ìŒ ë‹¨ê³„:

#### 1ë‹¨ê³„: ìƒíƒœ í™•ì¸
```bash
python setup_integration.py
```

#### 2ë‹¨ê³„: ì „ì²´ í…ŒìŠ¤íŠ¸  
```bash
python test_integration.py
```

#### 3ë‹¨ê³„: í™˜ê²½ ì„¤ì •
```powershell
$env:SCA_QWEN_MODEL_ID = "your_model_path"
```

#### 4ë‹¨ê³„: ì„œë²„ ì‹¤í–‰
```bash
python run_server.py
# ë˜ëŠ”
python -m sca_run.server --config config/default.toml
```

#### 5ë‹¨ê³„: ì›¹ì—ì„œ ì‚¬ìš©
```
http://localhost:8000
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| [INTEGRATION_GUIDE.md](INTEGRATION_GUIDE.md) | ìƒì„¸ ê°€ì´ë“œ |
| [INTEGRATION_COMPLETE.md](INTEGRATION_COMPLETE.md) | ì „ì²´ ìš”ì•½ |
| `sca_run/team_infer.py` | ë©”ì¸ í†µí•© ì½”ë“œ |
| `setup_integration.py` | ìƒíƒœ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸ |
| `test_integration.py` | í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ |
| `run_server.py` | ë¹ ë¥¸ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ |

---

## ğŸ“ í•™ìŠµ í¬ì¸íŠ¸

ì´ í†µí•© ê³¼ì •ì—ì„œ ë°°ìš´ ê²ƒ:

1. **ë§ˆì´í¬ ìŒì„± â†’ AI ì‘ë‹µ ì „ì²´ íë¦„**
   - ìŒì„± ìˆ˜ì§‘, íŠ¹ì§• ì¶”ì¶œ, AI ëª¨ë¸ ì¶”ë¡ , ìŒì„± ìƒì„±

2. **Log-Mel Spectrogram ì‚¬ìš© ì´ìœ **
   - ìŒì„±ì„ "ê·¸ë˜í”„"ë¡œ í‘œí˜„í•˜ì—¬ AIê°€ ì´í•´ ê°€ëŠ¥

3. **Qwen3-Omniì˜ FullDuplex êµ¬ì¡°**
   - ë™ì‹œì— ë“£ê³ (Thinker) ë§í•˜ê¸°(Talker) ê°€ëŠ¥

4. **WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ í†µì‹ **
   - ì‚¬ìš©ì ìŒì„± â†’ ì„œë²„ ì²˜ë¦¬ â†’ ì‹¤ì‹œê°„ ì‘ë‹µ

---

## ğŸš€ ë‹¤ìŒ ê°œì„  ë°©í–¥

1. **ì„±ëŠ¥ ìµœì í™”**
   - ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì—¬ëŸ¬ ì²­í¬ ë™ì‹œ ì²˜ë¦¬
   - KV Cache í™œìš©

2. **ê¸°ëŠ¥ í™•ì¥**
   - ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬
   - ë©€í‹° ì–¸ì–´ ì§€ì›
   - ê°ì • ë¶„ì„

3. **ëª¨ë‹ˆí„°ë§**
   - ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •
   - ìŒì§ˆ í‰ê°€
   - ì—ëŸ¬ ë¡œê¹…

---

**ì´ì œ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ì„œë²„ë¥¼ ì‹œì‘í•˜ì„¸ìš”! ğŸš€**

